---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

<!-- badges: start -->
[![GitHub release](https://img.shields.io/github/v/release/dadosdelaplace/pollspain)](https://github.com/dadosdelaplace/pollspain/releases)
<!-- badges: end -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pollspain

The main objective of the R package `{pollspain}` is to provide social scientists, political analysts, journalists, and citizens with easy and straightforward **access to electoral data from Spain**. This includes both **election results** extracted from polling stations (**aggregated by party and/or geographic level**) and **electoral survey data** (including the associated margins of error). The package also offers simple tools for **seat allocation**, **vote simulation**, and **results visualization**.

The package is designed so that users with basic knowledge of `R` can use it, providing **tidyverse-style functions**.

## Installation

You can **install the development version** of R package `{pollspain}` from [GitHub](https://github.com/) through the following code (please, note that you need to install `{devtools}` package before):

```{r eval = FALSE}
install.packages("devtools") # only if not already installed
devtools::install_github("dadosdelaplace/pollspain")
```


```{r message = FALSE, warning = FALSE}
# after installing
library(pollspain)
```

An **internet connection** is required for the installation, as well as for downloading data.

### Available information sources


```{r sources-info, echo = FALSE, eval = FALSE}
sources_info <-
  tibble("dataset" = ..., "description" = ...)
```

All the data is stored in the accompanying `pollspain-data` repository. You can find the data dictionary and more information about the data structure at <https://github.com/dadosdelaplace/pollspain-data>

## How to use?

### Election summaries

The **main function** is `summary_election_data(type_elec = ..., year = ..., level = ...)`, which given

* a vector of **election dates** (e.g., `year = 2023`),

* a vector of **election types** (currently, it only works properly for `type_elec = "congress"`),

* a geographic **level for aggregation** (e.g., `level = "ccaa"`),

returns a **summary table of election results aggregated at the administrative level** specified in `level` argument. This includes both general data (blank votes, turnout, etc) and the **number of votes received by each party or candidacy**. The available **aggregation levels** (`level`) are: `"all"` (for a national summary), `"ccaa"` (autonomous communities), `"prov"` (province), `"mun"` (municipality), `"mun_district"` (electoral district), `"sec"` (census section), and `"poll_station"` (raw results at the polling station level, without aggregation).

```{r summary-election-data-1, eval = FALSE}
# Summary election data at national level (general data without candidacies ballots)
summary_data_all <- summary_election_data(type_elec = "congress", year = 2019, month = 4)
summary_data_all
```

```{r summary-election-data-1-b, echo = FALSE, warning = FALSE, message = FALSE}
# Summary election data at national level (general data without candidacies ballots)
summary_data_all <-
  summary_election_data(type_elec = "congress", year = 2019, month = 4)
knitr::kable(summary_data_all)
```

```{r summary-election-data-3, eval = FALSE}
# Summary election data at prov level, aggregating the candidacies ballots
summary_data_prov_parties <- summary_election_data(type_elec = "congress", year = 2019, month = 4, level = "prov",  by_parties = TRUE)
head(summary_data_prov_parties, 5)
```

```{r summary-election-data-3-b, echo = FALSE, warning = FALSE, message = FALSE}
# Summary election data at ccaa level, aggregating the candidacies
# ballots, for three elections
summary_data_prov_parties <-  summary_election_data("congress", 2019, 4, level = "prov", by_parties = TRUE)
knitr::kable(head(summary_data_prov_parties, 5))
```

To do:

* explicar bien argumentos y usos (combina, de manera sencilla para el usuario, `get_election_data()` y `aggregate_election_data()`)
* solo año (con opción a dar fecha completa)
* by_parties y short version por defecto
* duplicates 1982 y 1986

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

### Seat allocation

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

### Resúmenes de encuestas

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

### Estimación de encuestas

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

### Simulación de resultados electorales

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

### Data viz

* barras ordenadas a más a menos (con colores)
* ggparlament
* encuestas + promedio
* barras con resultados + encuestas encima
* barras con % de voto vs %escaños?
* mapa
* ¿algún lollipop para mostrar housing efects? con flechas y eso.

<details>
<summary><strong>Advanced users</strong></summary>

Poner una aperitivo y referirle a los articles.

</details>

## Other functions

The ´{pollspain}` package also provides to un usuario más avanzado some useful functions to preprocess and analyze electoral data (even your own electoral data siempre y cuando they are provided in a properly format).

* **Utils**: functions contained in the `utils.R` script are intended to serve as **helper functions for data preprocessing**. See <...> for more examples about how to use them.

```{r}
type_to_code_election(type_elec = "congress")
extract_code("01-04-003-01-004-B", level = "mun")
extract_code("01-04-003-01-004-B", level = "mun", full_cod = TRUE)
```

* **Import raw data**: functions starting with `import_..._data()` (code can be found in the `import_elections_data.R` file) are aimed at importing and preprocessing as raw as possible the `.DAT` election files from the Spanish Ministry of Interior. All functions download the `.rda` files available in the Github repository \url{https://github.com/dadosdelaplace/pollspain-data}. See <...> for more examples about how to use them.


```{r import-poll-station-data}
# import and preprocess elections data at poll stations level for given election
# types and dates, providing variables related to turnout, blank/valid votes, etc
poll_data <- import_poll_station_data("congress", 2019, c(4, 11))
head(poll_data)
```


<!--

## Datos del CERA (pending)

According to the National Statistics Institute (INE):

«The electoral roll contains the registration of those who meet the requirements to be voters and are not definitively or temporarily deprived of the right to vote. The electoral roll is composed of:

* The electoral roll of Spanish citizens residing in Spain (CER).

* The electoral roll of Spanish citizens residing abroad (CERA).

The electoral roll of residents in Spain who are nationals of countries with Agreements for municipal elections (CERE Agreements), and the electoral roll of citizens of the European Union residing in Spain for municipal and European Parliament elections (CERE EU).»

The `get_CERA_data()` function returns the data related to the CERA.

```{r eval = FALSE}
ccaa_CERA_data <- get_CERA_data(election_data, level = "ccaa")
```

-->


## Authors

**Javier Álvarez-Liébana (maintainer)**, **David Pereiro-Pol**, **Mafalda González-González**, **Irene Bosque-Gala** and **Mikaela De Smedt**. 

`{pollspain}` package ha sido una parte de varios Trabajos Fin de Máster del Máster de Ciencias de Datos Computacionales de la UC3M (Madrid). The **usability and funcionality** of package has been tested by the following collaborators: 

## References

This package has been designed based on the following resources and references

* García Guzmán P (2025). WikiBarrio: Explore Spanish socio-demographic data at the neighborhood level. <https://www.wikibarrio.es/>


* García Guzmán P (2025). ineAtlas: Access to Spanish Household Income Distribution Atlas Data. R package version 0.1.3.9000, <https://github.com/pablogguz/ineAtlas>


* Meleiro H (2024). infoelectoral: Download Spanish Election Results. R package version 1.0.2, <https://github.com/rOpenSpain/infoelectoral>


* Data download repository of the Spanish Ministry of the Interior. <https://infoelectoral.interior.gob.es/es/elecciones-celebradas/area-de-descargas/>
