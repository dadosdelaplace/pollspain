<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How to use utils functions? • pollspain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="How to use utils functions?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pollspain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/about-data.html">About data</a></li>
    <li><a class="dropdown-item" href="../articles/utils.html">How to use utils functions?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dadosdelaplace/pollspain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>How to use utils functions?</h1>
                        <h4 data-toc-skip class="author">Javier Álvarez
Liébana</h4>
            
            <h4 data-toc-skip class="date">2025-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dadosdelaplace/pollspain/blob/main/vignettes/utils.Rmd" class="external-link"><code>vignettes/utils.Rmd</code></a></small>
      <div class="d-none name"><code>utils.Rmd</code></div>
    </div>

    
    
<p>This tutorial aims to illustrate how more <span class="hl"><strong>advanced developers can use the helper
functions</strong></span> in the <code>utils.R</code> script:</p>
<ul>
<li><code><a href="../reference/type_to_code_election.html">type_to_code_election()</a></code></li>
<li><code><a href="../reference/extract_code.html">extract_code()</a></code></li>
<li><code><a href="../reference/recod_mun.html">recod_mun()</a></code></li>
</ul>
<div class="section level2">
<h2 id="required-packages">Required packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h2>
<p>Let’s load the required packages for this tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dadosdelaplace/pollspain" class="external-link">pollspain</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-type-of-election-to-code">Convert type of election to code<a class="anchor" aria-label="anchor" href="#convert-type-of-election-to-code"></a>
</h2>
<p>According to the data extracted from the <a href="https://infoelectoral.interior.gob.es/opencms/es/elecciones-celebradas/area-de-descargas/Spanish" class="external-link">website
of the Spanish Ministry of the Interior</a>, each <strong>type of
election is associated in the databases with a specific alphanumeric
code</strong>: <code>"01"</code> (referendum), <code>"02"</code>
(congress), <code>"03"</code> (senate), <code>"04"</code> (local
elections), <code>"06"</code> (cabildo - Canarian council - elections),
and <code>"07"</code> (European Parliament elections). However, for
users, it’s much simpler to provide <strong>lexically explicit
terms</strong> — for example, writing <code>"congress"</code> for
congressional elections or <code>"senate"</code> for senatorial
elections. The <code><a href="../reference/type_to_code_election.html">type_to_code_election()</a></code> function allows us
to convert the user-provided term into the corresponding code required
by our databases.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/type_to_code_election.html">type_to_code_election</a></span><span class="op">(</span>type_elec <span class="op">=</span> <span class="st">"congress"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "02"</span></span>
<span><span class="fu"><a href="../reference/type_to_code_election.html">type_to_code_election</a></span><span class="op">(</span>type_elec <span class="op">=</span> <span class="st">"senate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "03"</span></span>
<span><span class="fu"><a href="../reference/type_to_code_election.html">type_to_code_election</a></span><span class="op">(</span>type_elec <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "04"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extract-region-codes">Extract region codes<a class="anchor" aria-label="anchor" href="#extract-region-codes"></a>
</h2>
<p>Similarly, many of the package’s functions allow the user to
<strong>aggregate data at different geographic levels</strong>, which
can be easily specified as <code>"all"</code>, <code>"ccaa"</code>,
<code>"prov"</code>, <code>"mun"</code>, <code>"mun_district"</code>,
<code>"sec"</code> (census tract), and <code>"poll_station"</code>.
Internally, however, each polling station is geolocated using a set of
codes provided by Spain’s National Statistics Institute (INE). The
<code><a href="../reference/extract_code.html">extract_code()</a></code> function enables us to <strong>extract the
code corresponding to the requested level of disaggregation from a full
polling station code</strong>.</p>
<p>For example, we can apply the function to polling station B of census
tract <code>"004"</code> within the first municipal district of the
municipality of Adra (<code>"003"</code>), located in the province of
Almería (<code>"04"</code>), which belongs to the autonomous community
of Andalusia (<code>"01"</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id_INE_poll_station</span> <span class="op">&lt;-</span> <span class="st">"01-04-003-01-004-B"</span></span></code></pre></div>
<p>What would be the municipality code corresponding to the polling
station?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"mun"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "003"</span></span></code></pre></div>
<p>What about the province code?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"prov"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "04"</span></span></code></pre></div>
<p>What about the municipal district?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"mun_district"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "01"</span></span></code></pre></div>
<p>By default, it only returns the code at the requested aggregation
level, but if you set <code>full_cod = TRUE</code>, you can obtain the
full code, including not only the code for that level but also for all
higher levels. For example, every province has a municipality with the
code <code>"001"</code>, so we need the corresponding province and
autonomous community codes to uniquely identify it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"mun"</span>, full_cod <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "01-04-003"</span></span>
<span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"prov"</span>, full_cod <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "01-04"</span></span>
<span><span class="fu"><a href="../reference/extract_code.html">extract_code</a></span><span class="op">(</span><span class="va">id_INE_poll_station</span>, level <span class="op">=</span> <span class="st">"mun_district"</span>, full_cod <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "01-04-003-01"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recoding-municipality-names">Recoding municipality names<a class="anchor" aria-label="anchor" href="#recoding-municipality-names"></a>
</h2>
<p>Over the years, various municipal mergers have taken place in Spain,
which means that not all elections feature the same set of
municipalities or the same identifying codes. In order to unify and
standardize the results provided to users, all output tables refer to
the most recent municipality recoding by the Spanish National Statistics
Institute (INE) (latest update: 2023). The helper function
<code><a href="../reference/recod_mun.html">recod_mun()</a></code> transparently returns the updated code based on
that recoding, reassigning codes for merged municipalities
accordingly.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Javier Álvarez-Liébana, David Pereiro-Pol, Mafalda González-González, Irene Bosque-Gala, Mikaela De Smedt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
